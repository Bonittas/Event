(this.$WP=this.$WP||[]).push(["36016d",(e,o)=>{var t,r,i,n,s,a,u,c,p,d,l,_,m,g,C,E,v,h,D,y,f=()=>{var{localize:e}=g();return n(o=>{switch(o){case"REJECTED_INACTIVE":return e.string("plus_checkout_promo_code_expired");case"REJECTED_CONNECTION_ERROR":return e.string("plus_checkout_promo_code_error");case"REJECTED_INVALID_USER":return e.string("plus_checkout_promo_code_unauthorized");case"REJECTED_ALREADY_USED":return e.string("plus_checkout_promo_code_used");default:return e.string("plus_checkout_promo_code_invalid")}},[e])},A={discountInputContainer:"vhdxv O f"},T=({formFieldPrefix:e="pc",...o})=>{var{localize:_}=g(),{promoCodeForm:C,updatePromoCodeForm:h}=s(l),{appliedPromoCode:D,displayState:f,errorText:R,isApplying:P,promoCodeField:b}=C,I=y(),O=E(),x=n(()=>{O({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_link"}}}),h({displayState:"ShowPromoCodes"})},[h,O]),k=n(e=>h({promoCodeField:{...b,value:e.toUpperCase()}}),[b,h]),N=n(()=>{O({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_apply",discountCode:b.value}}}),h({isApplying:!0})},[h,O,b]),S=n(e=>{O({OptimusDiscountCode:{optimusAction:{pageAction:"in_view",pageProperty:"promocode_error",attribute:e}}})},[O]),{subscriptionPrice:w}=T.useOptimusSubscriptionPrice("CHECKOUT"),{discount:L}=w||{};a(()=>{if(C.isApplying&&L?.discountCode){var{discountCode:e,discountedPrice:o,originalPrice:t,status:r}=L;"APPLIED"===r?h({appliedPromoCode:{amount:o-t,code:e,appliedPrice:w},isApplying:!1,promoCodeField:{...C.promoCodeField,isError:!1,value:""}}):h({appliedPromoCode:null,errorText:I(r),isApplying:!1,promoCodeField:{...C.promoCodeField,isError:!0,value:e}})}},[I,C,L,h,w]);var F=n(e=>I("REJECTED_CONNECTION_ERROR")===e?"connection_error":I("REJECTED_DISCOUNT_SERVICE_ERROR")===e?"invalid_code":I("REJECTED_INVALID_USER")===e?"unauthorized":I("REJECTED_ALREADY_USED")===e?"already_used":I("REJECTED_INACTIVE")===e?"cancelled_expired":"",[I]);return a(()=>{b.isError&&R&&(O({OptimusDiscountCode:{optimusAction:{pageAction:"failed",pageProperty:"promocode"}}}),S(F(R)))},[b,R,O,F,S]),t(p,{...o,children:r(d,{dividers:!0,space:"spacing-03",children:[t(i,{}),"ShowPromoCodes"===f&&!D&&r(p,{display:"flex",className:A.discountInputContainer,children:[t(v,{errorText:b.isError?R:void 0,id:`${e}-promoCodeInput`,marginRight:"spacing-03",onChange:e=>k(e.currentTarget.value),placeholder:_.string("plus_checkout_promo_code_placeholder"),state:b.isError?"error":"enabled",type:"text",value:b.value}),t(u,{dataAttributes:{"data-automation":"applyDiscount"},disabled:P,onClick:()=>b.value&&N(),variant:"secondary",children:t(m,{id:"plus_checkout_promo_code_apply"})})]}),"ShowLink"===f&&t(p,{marginY:"spacing-03",children:t(c,{dataAttributes:{"data-automation":"showDiscountInput"},onClick:x,children:t(m,{id:"plus_checkout_promo_code"})})})]})})};function R(e,o){var t=E(),{updatePromoCodeForm:r}=s(l),i=C(),{localize:a}=g(),u=C(),c=n(()=>{t({OptimusDiscountCode:{optimusAction:{pageAction:"success",pageProperty:"promocode"}}})},[t]),p=e?.discountCode;if(!e||!p)return null;var d=i.formatCurrencyInteger(e.originalPrice),_=e.discountedPrice-e.originalPrice,{expiryDate:m}=e,v=m?u.formatDate("date_short",new Date(m)):null,h=o?a.string("plus_partner_discount_tooltip",{0:o}):a.string("plus_first_year_discount_title"),D=`${a.string("plus_first_year_discount_body",{originalPrice:d})}
  ${v?a.string("plus_discount_expire_date",{expireDate:v}):""}`;return{onRemove:()=>r({appliedPromoCode:null}),price:_,rawPrice:_,title:p,...e.discountedPrice>0?{tooltipTitle:h,tooltipBody:D}:null,variant:"DISCOUNT",onRemoveVisible:c}}var P=()=>{var e="discountCode";return{setDiscountCode:o=>{h.set(e,o,864e5)},getDiscountCode:()=>h.get(e),clearDiscountCode:()=>{h.remove(e)}}},b={__key:0x914b16b5e13b,id:"914b16b5e13b0458b85a224ce2095d7f",loc:{},definitions:[]},I={TARGET:{img:"/img2/plus/plus-partner-logo-target.svg",altText:"Target logo"},ACORNS:{img:"/img2/plus/plus-partner-logo-acorns.svg",altText:"Acorns"},CLEAR:{img:"/img2/plus/plus-partner-logo-clear.svg",altText:"Clear"}},O=(e,o)=>{var t=o||!e,[{data:r,fetching:i,error:n}]=D({query:b,variables:{discountCode:e||""},pause:t});if(t)return{partnerName:null,partnerLogo:null,entitlement:null,fetching:!1,error:void 0};var s=r?.partnerEntitlement?.partnerName;return{partnerName:s?I[s]?.altText:void 0,partnerLogo:s?I[s]?.img:void 0,entitlement:r?.partnerEntitlement?.entitlement,error:n,fetching:i}},x={__key:0x7a1b57213480,id:"7a1b572134800fd87f99ec5a89f784f0",loc:{},definitions:[]},k=e=>{var[{data:o,fetching:t,error:r}]=D({query:x,variables:{discountCode:e||""},pause:!e});if(!e)return{data:null,fetching:!1};if(r)throw TypeError(r.message);return{data:o?.OptimusBenefits_getTermsAndConditionsForDiscountCode?.[0]||null,fetching:t}};return e("useDiscountCharge",R),[()=>{y=f,T.useOptimusSubscriptionPrice=_,e({default:T,useDiscountCharge:R,useDiscountCodePersistance:P,useOptimusEntitlement:O,useTermsAndConditionsForDiscountCode:k})},[e=>(t=e.jsx,r=e.jsxs,i=e.Fragment),e=>(n=e.useCallback,s=e.useContext,a=e.useEffect),e=>(u=e.default,c=e.BorderlessButton),e=>(p=e.Box,d=e.Stack),e=>l=e.Payment,e=>_=e.useOptimusSubscriptionPrice,e=>(m=e.default,g=e.useLocalize,C=e.useIntlFormatter),e=>E=e.useInteractionLogger,e=>v=e.TextInput,e=>h=e.default,e=>D=e.useQuery]]},["121h32","1o4yt4","jppfwt","lyyh8d","1yajq4","i9ixrv","17thqz","32pwc7","1u3aio","19b9b1","1mqwhq"]]);
