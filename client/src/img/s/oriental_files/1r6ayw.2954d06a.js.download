(this.$WP=this.$WP||[]).push(["1r6ayw",(e,t)=>{var r,o,a,i,s,c,n,u,l,d,_,p,m,g,b,I,y={__key:0xf5dce02a74e8,id:"f5dce02a74e8886c1412fa9d91c0192d",loc:{},definitions:[]},f=e=>{switch(e.__typename){case"Trips_LocationItemObject":if(e.object?.placeType==="COUNTRY")return e.object?.locationId;return e.object?.naturalParentId;case"Trips_AttractionItemObject":case"Trips_ForumPostItemObject":case"Trips_ReviewItemObject":return e.object?.location?.naturalParentId;default:return null}},j=e=>e?.__typename==="Trips_LocationItemObject",h=e=>e.object?.__typename==="Trips_LocationItemObject"&&e.object?.object?.placeType==="ACCOMMODATION"&&e.object?.object?.accommodationCategory==="HOTEL",v=(e,t)=>{switch(t){case"food_and_drink":return e.string("trips_v2_category_food_and_drink");case"forums":return e.string("trips_v2_category_forums");case"notes":return e.string("trips_v2_category_notes");case"photos_and_videos":return e.string("trips_v2_category_photos_and_videos");case"places_to_see":return e.string("trips_v2_category_places_to_see");case"places_to_go":return e.string("trips_v2_category_places_to_go");case"places_to_stay":return e.string("trips_v2_category_places_to_stay");case"reviews":return e.string("trips_v2_category_reviews");case"things_to_do":return e.string("trips_v2_category_things_to_do");default:return""}},T=e=>{switch(e.__typename){case"Trips_LocationItemObject":return e.object?.locationId;case"Trips_ReviewItemObject":return e.reviewId;case"Trips_LinkPostItemObject":return e.linkPostId;case"Trips_AttractionItemObject":return e.attractionProductId;case"Trips_PhotoItemObject":return e.photoId;case"Trips_VideoItemObject":return e.videoId;case"Trips_NoteItemObject":return e.noteId;case"Trips_ForumPostItemObject":return e.forumPostId;case"Trips_RepostItemObject":return e.repostId;default:return}},O=(e,t)=>{var r=new Date(e);return r.setDate(e.getDate()+t),r},w={__key:0xc18274f8e671,id:"c18274f8e671c4a49426cf9b548aad07",loc:{},definitions:[]},P=["places_to_stay","places_to_go","places_to_see","things_to_do","food_and_drink","notes"],z=e=>{var{localize:t}=l(),[a,i]=r([]),[s,c]=r([]),u=o(()=>(e.categorizedItems.find(e=>"photos_and_videos"===e.category)?.items||[]).map(e=>e?.object?.__typename==="Trips_VideoItemObject"&&e.object?.object?.__typename==="Media_VideoResult"||e?.object?.__typename==="Trips_PhotoItemObject"&&e.object?.object?.__typename==="Media_PhotoResult"?e.object?.object?.locationId:null).filter(Boolean),[e.categorizedItems]),[d]=n({query:w,variables:{locationIds:u},pause:!u?.length}),_=o(()=>{var e=new Map;return d?.data?.locations?.forEach(t=>{t?.locationId&&e.set(t.locationId,t)}),e},[d]),p=o(()=>e.tripLocations?.filter(e=>e?.location?.name&&e?.location?.locationId).map(e=>({id:String(e?.location?.locationId||""),label:e?.location?.localizedAdditionalNames?.long||e?.location?.name||""}))||[],[e.tripLocations]),m=o(()=>e.categorizedItems.map(e=>({id:e.category,label:v(t,e.category)}))||[],[e.categorizedItems,t]),g=o(()=>{if(!e.categorizedItems?.length)return[];if(!a.length&&!s.length)return e.categorizedItems;var t=e.categorizedItems.filter(e=>!a.length||a.includes(e.category));return s.length?t.map(e=>e?.category?{category:e.category,items:e?.items?.filter(e=>{if(!e?.object?.object)return!1;var t=f(e.object);return!!t&&s.includes(String(t))})||[]}:null).filter(Boolean):t},[e.categorizedItems,a,s]),b=o(()=>g.reduce((e,t)=>e+t.items.length,0),[g]),I=o(()=>e.categorizedItems.reduce((e,t)=>P.includes(t.category)?e+t.items.length:e,0),[e.categorizedItems]);return{tripSaves:e.categorizedItems,filteredTripSaves:g,filtersCount:a.length+s.length,tripLocations:p,tripCategories:m,categoryFilters:a,locationFilters:s,setCategoryFilters:i,setLocationFilters:c,totalItinerarySavesCount:I,filteredTripSavesCount:b,photoVideoLocationsMap:_}},k=({children:e,tripId:t,userId:r})=>{var{localize:a}=l(),c=d(),u=_(),b=g(r),[{data:f,fetching:j,error:h},v]=n({query:y,variables:{tripId:t,currency:c}});i(()=>{r!==b&&v({requestPolicy:"network-only"})},[r,b,v]);var w=f?.Trips_getTrips?.[0],[P,z]=o(()=>{var e=new Map,t=new Map;return w?.items?.forEach(r=>{if(r?.id&&r?.object&&e.set(r.id,r.object),r?.object?.object){var o=T(r.object.object);o&&t.set(o,r.object)}}),[e,t]},[w?.items]),k=o(()=>{var e={buckets:[],items:[]};return w?.structure&&(e.items=w?.structure?.items?.map(e=>e&&P.has(e)?P.get(e):null)?.filter(Boolean)||[],e.buckets=w?.structure?.buckets?.map((e,t)=>{var r=a.string("attractions.booking.section.mdtitinerary.day",{0:t+1});if(w?.date?.type==="DATES"&&w?.date?.from){var o=m(w.date.from);r=o?u.formatDate("date_full_month",O(o,t)):r}return e?.id?{id:e?.id,name:r,items:e?.items?.map(e=>e&&P.has(e)?P.get(e):null)?.filter(Boolean)||[]}:null})?.filter(Boolean)||[]),e},[w,P,a,u]),C=o(()=>w&&w.categorizedItems?.reduce((e,t)=>(t&&t?.category&&t?.items?.length&&e.push({category:t.category,items:t?.items?.map(e=>e&&P.has(e)?P.get(e):null)?.filter(Boolean)||[]}),e),[])||[],[w,P]),L=s(()=>{v({requestPolicy:"network-only"})},[v]),M=o(()=>({error:h,fetching:!w&&j,refetch:L,trip:w,categorizedItems:C,sanitizedStructure:k,itemsReferencesMap:z}),[C,h,j,z,L,k,w]);return p(I.Provider,{value:M,children:e})},C=()=>{var e=c(I);if(!e)throw Error("useTrip must be used within a TripProvider");return e};function L(e){var{refetch:t}=C(),[r,o]=u(e);return[r,s((e,r)=>o(e,r).then(e=>(t(),e)),[o,t])]}return e("useTripMutation",L),[()=>{b=z,e({TripContext:I=a(void 0),TripProvider:k,addDays:O,getItemReferenceId:T,getLocationIdFromTripSave:f,isHotelTripItem:h,isLocationItemObject:j,localizeTripCategoryName:v,useTrip:C,useTripMutation:L,useTripSaves:b})},[e=>(r=e.useState,o=e.useMemo,a=e.createContext,i=e.useEffect,s=e.useCallback,c=e.useContext),e=>(n=e.useQuery,u=e.useMutation),e=>(l=e.useLocalize,d=e.useCurrency,_=e.useIntlFormatter),e=>p=e.jsx,e=>m=e.isoStringToDate,e=>g=e.default]]},["1o4yt4","1mqwhq","17thqz","121h32","1o5y7t","dlu2yg"]]);
