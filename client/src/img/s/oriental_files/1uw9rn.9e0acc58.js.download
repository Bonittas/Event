(this.$WP=this.$WP||[]).push(["1uw9rn",(e,r)=>{var t,i,a,p,s,d,o,T,n,u,l,c,I,m,y,v,_,f,g=({object:e,sourceTripId:r,tripItemId:t})=>{var p=l(),[,n]=c(s),[,u]=c(d),[,y]=c(o),[v,_]=i({fetching:!1}),f=m("SAVE_TO_TRIP"),g=Number(e?.id),h=e?.type==="gaiTrip",P=e?.type==="publicTripBundle",E=a(()=>t?"COPY_TRIP_ITEM":h?"COPY_TRIP":"ADD_ITEM_TO_TRIP",[h,t]);if(!e)return[v,()=>Promise.resolve([null,null])];var R=(r,t,i)=>{r?t?(f(),_({fetching:!1,result:{trip:r,tripItem:t}})):["bundleSave","gaiTrip","publicTripBundle"].includes(e.type)?_({fetching:!1,result:{trip:r,tripItem:{__typename:"TripItem",id:0,comments:[],reference:{id:e.id.toString(),type:e.type}}}}):_({fetching:!1,error:{query:E,tripsError:i??void 0}}):_({fetching:!1,error:{query:E,tripsError:i??void 0}})};return[v,async i=>{_({fetching:!0});try{if(t&&r&&!isNaN(r)){var a,s,d,o=await y({copyComments:!1,sourceTripId:r,targetTripId:i,copyStructure:!1,sourceItemIds:[t]});o?.data?.Trips_copyTripItem?.itemIds?.[0]&&(s={__typename:"TripItem",id:o.data.Trips_copyTripItem.itemIds[0],comments:[],reference:{id:e.id.toString(),type:e.type}});var l=await p.query(T,{tripId:i}).toPromise();a=l?.data?.tripsGetOne,d=o?.data?.Trips_copyTripItem?.errors?.[0]}else if(h||P){if(!isNaN(g)){var c=await u({copyComments:!1,tripId:g,targetTripId:i,excludeItemTypes:["Note"]});a={id:c?.data?.Trips_copyTrip?.tripId??0,__typename:"Trip"},d=c?.data?.Trips_copyTrip?.errors?.[0]}}else{var m=await n({tripId:i,referenceId:`${e.id}`,referenceType:e.type,allowDuplicates:!1});a=m?.data?.addItemToTrip?.trip,d=m?.data?.addItemToTrip?.errors?.[0]?.error,a&&(s=I(a,e))}return R(a,s,d),[a,d]}catch(e){return console.error(e),_({fetching:!1,error:{query:E}}),[null,null]}}]},h="mostRecentlyAddedToTrip",P=(e,r)=>{r?y.set(h,{tripId:e,userId:r},144e5):y.remove(h)},E=e=>{var r=y.get(h);return r&&r.userId===e?r.tripId:null},R=({selectedTripId:e,object:r,isActive:t,onExplicitSave:i,tripItemId:a,sourceTripId:s})=>{var[d,o]=_({object:r,tripItemId:a,sourceTripId:s}),T=v();return[d,p(()=>{var a=e??E(T);return t||!a||r?.type!=null&&f.has(r.type)?(i&&i(),Promise.resolve([null,null])):o(a)},[t,r,i,o,T,e]),e=>P(e,T)]},q=(e,r,i)=>{var[a,p]=t.useState({fetching:!1,saved:!!i}),[,s]=c(n),[,d]=c(u);return[a,i?()=>i?(p({...a,fetching:!0}),d({itemId:i.id,tripId:r}).then(e=>{var r=e?.data?.tripsRemoveItem;return r?p({fetching:!1,saved:!1,result:{trip:r}}):p({fetching:!1,saved:!0,error:{query:"REMOVE_TRIP_ITEM",tripsError:void 0}}),a}).catch(()=>(p({fetching:!1,saved:!0,error:{query:"REMOVE_TRIP_ITEM"}}),a))):Promise.resolve(a):()=>(p({...a,fetching:!0}),s({tripId:r,referenceId:`${e.id}`,referenceType:e.type,allowDuplicates:!1}).then(e=>{var r=e?.data?.addItemToTrip?.trip,t=e?.data?.addItemToTrip?.errors?.[0]?.error;if(t||!r)return p({fetching:!1,saved:!1,error:{query:"ADD_ITEM_TO_TRIP",tripsError:t||void 0}}),a;var i=e?.data?.addItemToTrip?.items?.[0];return i?p({fetching:!1,saved:!0,result:{trip:r,tripItem:i}}):p({fetching:!1,saved:!1,error:{query:"ADD_ITEM_TO_TRIP"}}),a}).catch(()=>(p({fetching:!1,saved:!1,error:{query:"ADD_ITEM_TO_TRIP"}}),a)))]};return[()=>{_=g,f=new Set(["savesItem","bundleSave","gaiTrip","publicTripBundle"]),e({getMostRecentlyAddedToTrip:E,useAutosave:R,useSave:_,useTripSaveToggle:q})},[e=>(t=e,i=e.useState,a=e.useMemo,p=e.useCallback),e=>(s=e.AddItemToTrip,d=e.TripsCopyTrip,o=e.TripsCopyTripItem,T=e.GetTripTitle,n=e.AddItemWithFullTrip,u=e.RemoveItemWithFullTrip),e=>(l=e.useClient,c=e.useMutation),e=>I=e.getItemByReference,e=>m=e.usePixelCallback,e=>y=e.default,e=>v=e.useUserId]]},["1o4yt4","ag9b0s","1mqwhq","1iyqcw","1emwhd","19b9b1","52far5"]]);
