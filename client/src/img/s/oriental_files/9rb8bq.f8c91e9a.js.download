(this.$WP=this.$WP||[]).push(["9rb8bq",(e,t)=>{var a,i,r,n,o,s,l,d,p,c,u,T,v,C,m,S,I,b,E,h,k,g,y,f,_,A,M,O,P,L,R,N,w,j,D,V,x,F,q,U,z,G,B=(e,t)=>{if(!t)return e;var a=e.paginatedTrips?.trips||[],i=t.paginatedTrips?.trips||[];return{paginatedTrips:e.paginatedTrips?{trips:[...a,...i],hasMore:!!t.paginatedTrips?.hasMore,__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},W=e=>({__typename:e.__typename,id:e.id||0,title:e.title||void 0,status:e.status||void 0,photoId:e.photoId||void 0,photo:e.photo||{},route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!!e.actionPermissions?.canAddItem}}),Q=e=>{var t=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:i}=e;return i&&a===i.type&&t===String(i.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},[a,i]=R({query:w,variables:{offset:0,limit:10,userId:E()||"",reference:u(e),loadSavedTrips:!0},combineData:B,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:a}})=>t(e,a),Trips_moveTripItems:({variables:{reference:e}})=>t(e?.id,e?.type),tripsRemoveItem:({variables:{reference:e}})=>t(e?.id,e?.type),tripsRemoveReference:({variables:{reference:e}})=>t(e?.id,e?.type),Trips_copyTripItem:({variables:{reference:e}})=>t(e?.id,e?.type)}}),r=a.data?.paginatedTrips?.trips||[],n=r.slice().filter(Boolean).map(W),o=!!a.data?.paginatedTrips?.hasMore,s=a.data?.savedTrips||[],l=new Set(s.map(e=>e?.id).filter(Boolean));return{fetching:a.fetching,error:!!a.error,data:{tripList:n,saveSet:l,canMakePublicTrip:!0},hasMore:o,loadMore:o?()=>i({offset:r?.length||0,loadSavedTrips:!1}):()=>Promise.resolve()}},X={loadingContainer:"tvfpI Fn f u j",modalPadding:"RyNfJ"},$={DEFAULT:e=>"bundleSave"!==e?a(M,{id:"stat_modal_save_to_trip_v2"}):a(M,{id:"save_all_items_modal_header"}),CREATE:()=>a(M,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>a(M,{id:"select_trip_header"}),SELECT_CREATE:()=>a(M,{id:"stat_modal_create_a_trip_v2"})},K=()=>a("div",{className:X.loadingContainer,children:a(A,{size:"large"})}),Y=({saveObject:e,initialTitle:t,overlayState:i,validateTripName:s,lastSavedItem:d,trackingContext:p,trackingSource:c,sourceTripId:u,tripItemId:v,...C})=>{var m,[S,I]=r(!0),{fetching:b,error:E,data:h,hasMore:k,loadMore:g}=j(e);b?m=a(A,{size:"large"}):E&&(m=a(P,{refetch:g}));var M="gaiTrip"===e.type,R="publicTripBundle"===e.type,N=M?"COPY":"SAVE";n(()=>{b||I(!1)},[]);var[w]=l({source:c||"trips",trackingContext:p,pageAsContext:!0,withSaveSession:!0}),q=()=>{C.onClose(),I(!0)},U=$[i](e.type),z=a(f,{icon:_,displayType:"LEFT_ALIGN_GRAY",children:U});return a(O,{element:"bundleSave"===e.type?"copyTripModal":"saveTripModal",children:a(y,{header:z,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:q,children:m&&S?a("div",{className:X.loadingContainer,children:m}):(()=>{var r=d?T(d):void 0,n=()=>M||R?a(L,{children:a(o,{fallback:a(K,{}),children:a(x,{onCreateTripInputChange:C.onCreateTripInputChange,gate:()=>Promise.resolve(),object:e,initialTitle:t,onMount:()=>{b||E||w({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{C.statCallback("ADD","NEW",e,!0,!0),q()},canMakePublicTrip:h.canMakePublicTrip,validateTripName:s,trackingContext:p,trackingSource:c})})}):a(L,{children:a(o,{fallback:a(K,{}),children:a(D,{gate:()=>Promise.resolve(),object:e,onMount:()=>{b||E||w({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{C.statCallback("ADD","NEW",e,!0,!0),q()},onError:C.onError,canMakePublicTrip:h.canMakePublicTrip,validateTripName:s,trackingContext:p,trackingSource:c,sourceTripId:u,tripItemId:v})})});switch(i){case"DEFAULT":return 0===h.tripList.length?a("div",{className:X.modalPadding,children:n()}):a(L,{children:a(o,{fallback:a(K,{}),children:a(F,{tripList:h.tripList,savedSet:h.saveSet,tripListBottom:m,onPaginate:g,hasMore:k,saveObject:e,onMount:()=>{C.preventInteractionInMountedComponents||w({elementClick:{element:"stat"}})},onCreateTrip:()=>{C.onCreateTripClicked&&C.onCreateTripClicked()},tripAction:N,onRemovedFromTrip:(e,t,a)=>{C.statCallback("REMOVE","EXISTING",e,t,a),q()},onSavedToTrip:(e,t,a)=>{C.statCallback("ADD","EXISTING",e,t,a),q()},onSaveToTripClick:(e,t,a)=>{C.statCallback("CLICK","EXISTING",e,t,a)},onError:C.onError,trackingContext:p,trackingSource:c,sourceTripId:u,tripItemId:v})})});case"CREATE":return a("div",{className:X.modalPadding,children:n()});case"SELECT":if(r)return a(L,{children:a(o,{fallback:a(K,{}),children:a(F,{tripList:h.tripList,savedSet:h.saveSet,tripListBottom:m,onPaginate:g,hasMore:k,saveObject:r,onMount:()=>{w({elementClick:{element:"stat"}})},onCreateTrip:()=>{C.onSelectCreateTripClicked&&C.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,a)=>{C.statCallback("MOVE","EXISTING",e,t,a),q()},onRemovedFromTrip:(e,t,a)=>{C.statCallback("REMOVE","EXISTING",e,t,a),q()},onError:C.onError,trackingContext:p,trackingSource:c,sourceTripId:u,tripItemId:v})})});return"";case"SELECT_CREATE":if(d)return a("div",{className:X.modalPadding,children:a(L,{children:a(o,{fallback:a(K,{}),children:a(V,{gate:()=>Promise.resolve(),item:d,onMovedToCreatedTrip:e=>{C.statCallback("MOVE","NEW",e,!0,!0),q()},canMakePublicTrip:h.canMakePublicTrip})})})});return n();default:return""}})()})})},H=e=>{},J=(e,t)=>{switch(t.type){case"setOverlayState":return{...e,overlayState:t.state??e.overlayState};case"afterSave":return{...e,overlayState:"DEFAULT",preventInteractionInMountedComponents:!0};default:throw Error()}},Z=({allowPopStatModal:e,logInteraction:t,puid:r,object:n,active:o,initialTitle:s,preventInteractionPropagation:l,trackingContext:d,trackingSource:c,resaveTrip:u,saveObject:T,saveStatus:v,updateLastTripId:m,onClose:S,initialOverlayState:I,onViewTripToastVisible:b,viewTripOpensNewTab:g,tripItemId:y,sourceTripId:f,..._})=>{var A=E(),{launchViewTripToast:M,launchRemoveFromTripToast:O,launchErrorTripToast:P}=C(),{getTripErrorMessage:L}=h(),R=k("SAVE_TO_TRIP_INTENT"),N=k("SAVE_TO_TRIP"),w=k({type:"CREATE_TRIP",payload:{user_id:A||""}}),j=i.useContext(p),[D,V]=i.useReducer(J,{overlayState:I||"DEFAULT",preventInteractionInMountedComponents:!1}),{onComplete:x}=_,F=i.useCallback((e,t,a,i,r)=>{x&&x(e,t,a,i,r),j.resetSession()},[x,j]),U=i.useCallback((e,a)=>{e&&!a?(M({trip:e,messageType:"SAVED",onCtaClick:()=>{t({elementClick:{element:"saved_viewTrip"}})}}),F(!0,"SAVED")):a&&(P(a),F(!1)),V({type:"setOverlayState",state:"DEFAULT"}),t({elementClick:{element:"unsave_undo"}})},[M,F,P,t]),z=i.useCallback(e=>{O(e,T,U)},[O,U,T]),G=i.useCallback(e=>{P(e)},[P]),[B,W]=i.useState(!1),Q=i.useCallback(()=>{W(!0),j.resetSession()},[j]),X=i.useCallback((e,a,i)=>{"CREATED"===a&&(N(),w()),V({type:"afterSave"}),M({trip:e,messageType:a,onCtaClick:()=>{t({elementClick:{element:"saved_viewTrip"}})},onVisible:()=>b?.(a,e.id),openTripInNewTab:g}),m(e.id),F(!0,a,e.id,e.title,i)},[M,m,F,N,w,t,b,g]);return B?null:a("div",{className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!l&&A&&t({elementClick:{element:"item_save",tripId:u?.id}}),o||R()},children:a(q,{onCreateTripInputChange:_.onCreateTripInputChange,saveObject:T,initialTitle:s,overlayState:D.overlayState,lastSavedItem:v.result?.tripItem,trackingContext:d,trackingSource:c,onCreateTripClicked:()=>{V({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{V({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:Q,onError:G,preventInteractionInMountedComponents:D.preventInteractionInMountedComponents,statCallback:(e,t,a,i,r=!1)=>{a&&"id"in a&&("REMOVE"===e?(z(a),F(r)):"NEW"===t?X(a,"CREATED",Number(T.id)):"CLICK"===e&&"EXISTING"===t?_?.onItemClick?.(a.id,a.title):i&&X(a,"SAVED",Number(T.id)))},validateTripName:e=>{if("bundleSave"===T.type&&e.trim().toLowerCase()===n.title.trim().toLowerCase())return L("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})},tripItemId:y,sourceTripId:f})})},ee=e=>a(d,{children:a(g,{children:a(Z,{...e})})}),et=["Profile","HomeFeed","Trips","Home"],ea=e=>{var t=i.useMemo(()=>e.saveObject||T(e.object,!0),[e.saveObject,e.object]),{resaveTrip:r,onComplete:n,allowPopStatModal:o,flowOrigin:s,onAutosavedToTripToastVisible:d}=e,{isNativeWebview:u,tripId:v,tripItemId:E,sourceTripId:h,...k}=e,{launchAutoSavedToTripToast:g,launchErrorTripToast:y}=C(),f=m(),{page:_}=f,[A,M]=l(i.useMemo(()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0}),[e.trackingContext,e.trackingSource,t])),O=i.useContext(p),[P,L,R]=S({selectedTripId:v,object:t,isActive:e.active,tripItemId:E,sourceTripId:h}),N=t?.id,w=t?.type,j=i.useCallback(e=>{y(e)},[y]),D=i.useCallback(()=>{A({elementClick:{element:"ITEM_SAVE_LOGIN",context:_&&c(_)||void 0,puid:M,saveType:w,detailId:N?`${N}`:"",tripId:r?.id,sessionType:"SAVE",sessionUuid:O.sessionUuid,sessionOrder:O.sessionOrder}})},[A,_,M,r,N,w,O.sessionOrder,O.sessionUuid]),V=i.useCallback(()=>{A({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:_&&c(_)||void 0,puid:M,saveType:w,detailId:N?`${N}`:"",tripId:r?.id,sessionType:"SAVE",sessionUuid:O.sessionUuid,sessionOrder:O.sessionOrder}})},[A,_,M,r,N,w,O.sessionOrder,O.sessionUuid]),x=I(i.useMemo(()=>({pid:_&&et.includes(f.page)?40439:39766,flow:u?"NATIVE_LOGIN":"SAVES_COMBINED",flowOrigin:s,onLogin:D,onSuccess:V,isFullWidthMobile:!0}),[D,V,_,f.page,u,s])),F=i.useRef(!1),{open:q}=b(()=>t?a(U,{...k,logInteraction:A,puid:M,initialTitle:e.initialTitle,saveObject:t,saveStatus:P,updateLastTripId:R,viewTripOpensNewTab:e.viewTripOpensNewTab,sourceTripId:h,tripItemId:E}):null),{open:z}=b(()=>t?a(U,{...k,initialOverlayState:"SELECT",logInteraction:A,puid:M,saveObject:t,saveStatus:P,updateLastTripId:R,viewTripOpensNewTab:e.viewTripOpensNewTab,sourceTripId:h,tripItemId:E}):null),G=!!o&&"popStat"in f.params&&f.params.popStat;return i.useEffect(()=>{G&&!F.current&&(F.current=!0,A({elementClick:{element:"autoPopStat"}}),x().then(q))},[A,x,q,G]),i.useCallback(()=>{x().then(()=>L()).then(([e,t])=>{if(null===e&&null===t){q();return}t?j({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(g(e,()=>{z(),A({elementClick:{element:"quickSave_change"}})},()=>d?.("SAVED",e.id)),A({modalSuccess:{element:"quickSave",tripId:r?.id,context:_&&c(_)||void 0,saveType:w,detailId:N?`${N}`:""}}),n&&n(!0,void 0,e.id,e.title,Number(N)))})},[q,z,d,g,A,x,n,j,L,_,r,N,w])},ei=({children:e,...t})=>{var r=i.useMemo(()=>t.saveObject||T(t.object,!0),[t.saveObject,t.object]),n=z(t);return r?a(d,{children:e(n)}):null},er=({queryObject:e,object:t,children:i,...r})=>{function n(t,a){if(!t||!a)return"invalidateAndRefetch";var{originalObject:i}=e;return i&&a===i.type&&t===String(i.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"}var o=E(),[{fetching:s,data:l}]=N({query:e.query,variables:e.variables,pause:!o},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>n(e,t),tripsRemoveItem:({variables:{reference:e}})=>n(e?.id,e?.type),tripsRemoveReference:({variables:{reference:e}})=>n(e.id,e?.type),Trips_copyTrip:({variables:{reference:e}})=>n(e?.id,e?.type),Trips_cloneTrip:({variables:{reference:e}})=>n(e?.id,e?.type),Trips_copyTripItem:({variables:{reference:e}})=>n(e?.id,e?.type)}),{id:d,socialStatistics:p}=l?.savesObjects?.[0]??t?.object??t??{},c=!1;return(void 0===d||d===e.id||String(d)===e.id)&&(c=!!p?.isSaved),a(G,{active:c,object:t,...r,children:e=>i(e,c,s)})},en=e=>{var t=e.saveObject||T(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var i=v(t);return i?a(er,{...e,queryObject:i}):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{j=Q,D=s(()=>t("5kzfzt").then(e=>({default:e.CreateTripWithAddItemModal}))),V=s(()=>t("5kzfzt").then(e=>({default:e.CreateTripWithMoveItemModal}))),x=s(()=>t("5kzfzt").then(e=>({default:e.CloneTripWithAddItemModal}))),F=s(()=>t("an5ymg").then(e=>({default:e.SaveToTripContent}))),q=Y,Z.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},U=ee,z=ea,G=ei,en.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:en,STATModal:q,TripFlowSelector:G,setSTATDisabledForTesting:H,useSTATModal:z})},[e=>a=e.jsx,e=>(i=e,r=e.useState,n=e.useEffect,o=e.Suspense,s=e.lazy),e=>(l=e.useTripInteraction,d=e.SaveSessionProvider,p=e.SaveSessionTrackingContext,c=e.getInteractionsContext),e=>(u=e.toReference,T=e.toSavesObject,v=e.objectStatisticQuery),e=>C=e.default,e=>m=e.useRoute,e=>S=e.useAutosave,e=>I=e.useSocialLoginGate,e=>b=e.useVDOMPortal,e=>E=e.useUserId,e=>h=e.useLocalizeTripError,e=>k=e.usePixelCallback,e=>g=e.ToastProvider,e=>y=e.default,e=>f=e.TitleBar,e=>_=e.default,e=>A=e.LoadingSpinner,e=>M=e.default,e=>O=e.TripsImpression,e=>P=e.default,e=>L=e.ErrorBoundary,e=>(R=e.usePaginatedQuery,N=e.useInvalidatableQuery),e=>w=e.TripDetailStatQuery]]},["121h32","1o4yt4","1k7dpq","1iyqcw","12wscm","fgwvq1","1uw9rn","10506z","14euae","52far5","mc5s4b","1emwhd","tr3542","17u7gi","cnyhjq","1l75rc","1l9qeu","17thqz","665v5s","qhcore","183pm0","1fbuhs","ag9b0s"]]);
